<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Configura tu perfil</title>
</head>

<body>

    <h2>Configura tu perfil</h2>
    <p>Esta es una configuración inicial de tu perfil. Podrás modificarla luego.</p>

    <form id="perfilForm">
        <label>Nombre del restaurante:</label><br>
        <input type="text" name="nombre" required><br><br>

        <label>Logo del restaurante:</label><br>
        <input type="file" name="logo"><br><br>

        <label>Descripción general:</label><br>
        <textarea name="descripcion"></textarea><br><br>

        <label>Ubicación - Selecciona en el mapa tu ubicación:</label><br>
        <p>[Mapa aquí]</p><br>

        <label>Redes sociales:</label><br>
        <input type="checkbox" name="facebook"> Facebook
        <input type="checkbox" name="instagram"> Instagram
        <input type="checkbox" name="tiktok"> Tiktok
        <input type="checkbox" name="x"> X
        <input type="checkbox" name="whatsapp"> Whatsapp
        <br><br>

        <label>Horario:</label><br>
        <table>
            <tr>
                <th>Día</th>
                <th>Apertura</th>
                <th>Cierre</th>
            </tr>
            <tr>
                <td>Lunes</td>
                <td><input type="time" name="lunes_apertura"></td>
                <td><input type="time" name="lunes_cierre"></td>
            </tr>
            <tr>
                <td>Martes</td>
                <td><input type="time" name="martes_apertura"></td>
                <td><input type="time" name="martes_cierre"></td>
            </tr>
            <tr>
                <td>Miércoles</td>
                <td><input type="time" name="miercoles_apertura"></td>
                <td><input type="time" name="miercoles_cierre"></td>
            </tr>
            <tr>
                <td>Jueves</td>
                <td><input type="time" name="jueves_apertura"></td>
                <td><input type="time" name="jueves_cierre"></td>
            </tr>
            <tr>
                <td>Viernes</td>
                <td><input type="time" name="viernes_apertura"></td>
                <td><input type="time" name="viernes_cierre"></td>
            </tr>
            <tr>
                <td>Sábado</td>
                <td><input type="time" name="sabado_apertura"></td>
                <td><input type="time" name="sabado_cierre"></td>
            </tr>
            <tr>
                <td>Domingo</td>
                <td><input type="time" name="domingo_apertura"></td>
                <td><input type="time" name="domingo_cierre"></td>
            </tr>
        </table><br>

        <label>Teléfono:</label><br>
        <input type="tel" name="telefono"><br><br>

        <button type="submit">Guardar configuración</button>
    </form>

    <script>
        const form = document.getElementById('perfilForm');

        form.addEventListener('submit', async function (e) {
            e.preventDefault();

            const urlParams = new URLSearchParams(window.location.search);
            const restauranteId = urlParams.get('restauranteId');

            if (!restauranteId) {
                alert("ID del restaurante no encontrado.");
                return;
            }

            const formData = new FormData(form);
            const datos = Object.fromEntries(formData.entries());

            // Red social: true/false
            ['facebook', 'instagram', 'tiktok', 'x', 'whatsapp'].forEach(red => {
                datos[red] = formData.get(red) !== null;
            });

            try {
                const res = await fetch(`/api/restaurante/${restauranteId}/perfil`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(datos)
                });

                const response = await res.json();
                if (res.ok) {
                    alert("Perfil guardado correctamente");
                    window.location.href = "/index.html";
                } else {
                    alert(response.error || "Error al guardar perfil.");
                }
            } catch (err) {
                console.error("Error:", err);
                alert("Error de red al guardar perfil.");
            }
        });
    </script>

</body>

</html>